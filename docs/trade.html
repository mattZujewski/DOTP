<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trade Analysis ‚Äî DOTP Dynasty</title>
  <script>if(localStorage.getItem('dotp_theme')==='dark')document.documentElement.classList.add('dark');</script>
  <link rel="stylesheet" href="css/style.css" />
  <!-- CDN libraries -->
  <script src="js/chart.umd.min.js"></script>
  <script src="js/chartjs-fix.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
</head>
<body>
  <script src="js/nav.js"></script>

  <main class="page-container">
    <header class="page-header">
      <h1>üîÑ Trade Analysis</h1>
      <p class="subtitle">All 6 seasons ¬∑ 12 owners ¬∑ interactive filters</p>
    </header>

    <!-- Filter Bar -->
    <div class="chart-section" style="padding:18px 24px">
      <div class="filter-bar" id="year-filter-bar">
        <div class="loading-spinner" style="height:36px"><div class="spinner"></div></div>
      </div>
      <div style="display:flex;align-items:center;flex-wrap:wrap;gap:10px;margin-top:10px">
        <span id="owner-filter-label" style="font-size:0.82rem;font-weight:600;color:var(--brand-green)"></span>
        <button id="clear-owner-filter" class="btn btn-ghost btn-sm" style="display:none">‚úï Clear Filter</button>
        <span class="text-muted" style="font-size:0.8rem">Click any chart bar or node to filter by owner</span>
        <button id="compare-toggle-btn" class="btn btn-outline btn-sm" style="margin-left:auto">
          ‚öñÔ∏è Compare Two Owners
        </button>
      </div>

      <!-- Compare Panel (hidden until toggled) -->
      <div id="compare-panel" style="display:none;margin-top:14px;padding:14px 18px;background:var(--bg-primary);border-radius:var(--radius-md);border:1px solid var(--border)">
        <div style="display:flex;align-items:center;flex-wrap:wrap;gap:12px">
          <span style="font-size:0.82rem;font-weight:700;color:var(--text-secondary)">Compare:</span>
          <select id="compare-owner-a" class="filter-select">
            <option value="">Select Owner A‚Ä¶</option>
          </select>
          <span style="color:var(--text-muted);font-weight:600">‚Üî</span>
          <select id="compare-owner-b" class="filter-select">
            <option value="">Select Owner B‚Ä¶</option>
          </select>
          <button id="compare-run-btn" class="btn btn-primary btn-sm" disabled>View Trades</button>
          <button id="compare-close-btn" class="btn btn-ghost btn-sm">‚úï</button>
        </div>
        <p id="compare-summary" style="margin-top:8px;font-size:0.8rem;color:var(--text-muted)"></p>
      </div>
    </div>

    <!-- Chart 1: Trades Per Owner -->
    <div class="chart-section">
      <h2>Trade Participation by Owner</h2>
      <p class="chart-description">Total trade events each owner participated in. Click a bar to filter all charts to that owner.</p>
      <div class="chart-wrapper" style="height:340px">
        <canvas id="chart-per-owner"></canvas>
      </div>
      <p class="chart-insight" id="insight-per-owner"></p>
    </div>

    <!-- Chart 2: Trade Partner Matrix -->
    <div class="chart-section">
      <h2>Trade Partner Matrix</h2>
      <p class="chart-description">How many times each pair of owners has traded. Hover for exact counts, click for trade list.</p>
      <div class="d3-container" id="chart-matrix-d3" style="min-height:260px">
        <div class="loading-spinner"><div class="spinner"></div></div>
      </div>
      <p class="chart-insight" id="insight-matrix"></p>
    </div>

    <!-- Chart 3: Trade Network -->
    <div class="chart-section">
      <h2>Trade Network</h2>
      <p class="chart-description">Force-directed graph of trade relationships. Node size = total volume. Drag nodes to explore. Hover for details.</p>
      <div class="d3-container" id="chart-network-d3" style="min-height:400px">
        <div class="loading-spinner"><div class="spinner"></div></div>
      </div>
      <p class="chart-insight" id="insight-network"></p>
    </div>

    <!-- Chart 4: Timeline -->
    <div class="chart-section">
      <h2>Trade Activity Timeline</h2>
      <p class="chart-description">Monthly trade volume across all seasons. Hover for exact counts.</p>
      <div class="chart-wrapper" style="height:240px">
        <canvas id="chart-timeline"></canvas>
      </div>
      <p class="chart-insight" id="insight-timeline"></p>
    </div>

    <!-- Chart 5: Heatmap -->
    <div class="chart-section">
      <h2>Trade Activity Heatmap</h2>
      <p class="chart-description">Year √ó Month view of trade frequency. Darker cells = more trades. Hover for exact counts.</p>
      <div class="d3-container" id="chart-heatmap-d3" style="min-height:200px">
        <div class="loading-spinner"><div class="spinner"></div></div>
      </div>
      <p class="chart-insight" id="insight-heatmap"></p>
    </div>

    <!-- Chart 6: 2-Team vs 3-Team -->
    <div class="chart-section">
      <h2>2-Team vs 3-Team Trades Per Season</h2>
      <p class="chart-description">Breakdown of trade complexity by year.</p>
      <div class="chart-wrapper" style="height:300px">
        <canvas id="chart-multiteam"></canvas>
      </div>
      <p class="chart-insight" id="insight-multiteam"></p>
    </div>

    <!-- Chart 7: Trade Type Breakdown (FEAT-02) -->
    <div class="chart-section">
      <h2>Trade Type Breakdown</h2>
      <p class="chart-description">
        How trades are structured ‚Äî player swaps, pick trades, FAAB deals, and mixed packages.
        Click any segment or row to drill into matching trades.
        <span id="type-filter-label" style="font-size:0.82rem;font-weight:600;color:var(--brand-green);margin-left:8px"></span>
        <button id="clear-type-filter" class="btn btn-ghost btn-sm" style="display:none;margin-left:4px">‚úï Clear</button>
      </p>
      <div style="display:flex;flex-wrap:wrap;gap:24px;align-items:flex-start">
        <div style="flex:0 0 260px;min-width:220px">
          <canvas id="chart-trade-type" style="max-height:260px"></canvas>
        </div>
        <div id="trade-type-table-wrap" style="flex:1;min-width:240px">
          <table class="data-table" id="trade-type-table" style="font-size:0.84rem">
            <thead>
              <tr>
                <th>Type</th>
                <th style="width:60px;text-align:right">Count</th>
                <th style="width:80px;text-align:right">% of All</th>
              </tr>
            </thead>
            <tbody id="trade-type-tbody"></tbody>
          </table>
          <div id="trade-subtype-wrap" style="display:none;margin-top:14px">
            <p style="font-size:0.78rem;font-weight:700;color:var(--text-secondary);margin-bottom:6px">Player-for-Player breakdown:</p>
            <canvas id="chart-trade-subtype" style="max-height:180px"></canvas>
          </div>
        </div>
      </div>
      <p class="chart-insight" id="insight-trade-type"></p>
    </div>

    <!-- Chart 8: Volume by Season / Owner -->
    <div class="chart-section">
      <h2>Trade Volume Per Owner by Season</h2>
      <p class="chart-description">How each owner's trade activity has changed year over year.</p>
      <div class="chart-wrapper" style="height:340px">
        <canvas id="chart-vol-season"></canvas>
      </div>
      <p class="chart-insight" id="insight-vol-season"></p>
    </div>

    <!-- Trade Events List -->
    <div class="chart-section">
      <h2>Trade Events List</h2>
      <p class="chart-description">
        <span id="trade-list-count">Loading‚Ä¶</span> ‚Äî players shown inline. Click a row for full details &amp; post-trade tenure.
      </p>
      <div class="data-table-wrapper">
        <table class="data-table" id="trade-events-table">
          <thead>
            <tr>
              <th style="width:90px">Date</th>
              <th style="width:150px">Parties</th>
              <th>Sent</th>
              <th>Received</th>
              <th style="width:60px">Type</th>
              <th style="width:55px">Season</th>
            </tr>
          </thead>
          <tbody id="trade-list-tbody">
            <tr><td colspan="6" class="text-center text-muted" style="padding:24px">Loading‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Traded Picks Results -->
    <div class="chart-section">
      <h2>Traded Picks Results</h2>
      <p class="chart-description">
        Every draft pick that changed hands in a trade, and what player was eventually selected with it.
        <span id="picks-filter-label" style="margin-left:8px;font-weight:600;color:var(--accent)"></span>
        <button id="clear-picks-filter" style="display:none;margin-left:8px;padding:2px 10px;font-size:12px;cursor:pointer;border:1px solid var(--accent);background:transparent;color:var(--accent);border-radius:4px">‚úï Clear</button>
      </p>

      <!-- Summary bar: status chips -->
      <div id="picks-summary-bar" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px"></div>

      <!-- Main table -->
      <div class="data-table-wrapper">
        <table class="data-table" id="picks-table">
          <thead>
            <tr>
              <th style="width:70px">Pick</th>
              <th style="width:90px">Trade Date</th>
              <th>Traded From ‚Üí To</th>
              <th>Original Holder</th>
              <th>Drafted Player</th>
              <th>Current Owner</th>
              <th style="width:80px">Status</th>
            </tr>
          </thead>
          <tbody id="picks-tbody">
            <tr><td colspan="7" class="text-center text-muted" style="padding:24px">Loading‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
      <p class="chart-insight" id="insight-picks"></p>
    </div>
  </main>

  <script src="js/charts.js"></script>
  <script src="js/trade_charts.js"></script>
  <script src="js/chatbot.js"></script>
</body>
</html>
